!function e(t,r,n){function o(u,a){if(!r[u]){if(!t[u]){var s="function"==typeof require&&require;if(!a&&s)return s(u,!0);if(i)return i(u,!0);var p=new Error("Cannot find module '"+u+"'");throw p.code="MODULE_NOT_FOUND",p}var l=r[u]={exports:{}};t[u][0].call(l.exports,function(e){var r=t[u][1][e];return o(r?r:e)},l,l.exports,e,t,r,n)}return r[u].exports}for(var i="function"==typeof require&&require,u=0;u<n.length;u++)o(n[u]);return o}({1:[function(e,t,r){"use strict";function n(){}function o(e,t,r){function n(e){this.name=t,Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,r&&r.apply(this,arguments)}return n.prototype=Object.create(e.prototype),n.prototype.name=t,n.prototype.constructor=n,n}n.prototype=Object.create(Error.prototype),n.prototype.constructor=n;var i=o(n,"InternalError"),u=o(n,"SyntaxError"),a=o(n,"ParseError"),s=o(n,"NameResolutionError"),p=o(n,"CycleError"),l=o(n,"RebindingError"),c=o(n,"CircularBindingError"),f=o(n,"TypeError");t.exports={RindelError:n,deriveErrorClass:o,SyntaxError:u,InternalError:i,ParseError:a,NameResolutionError:s,CycleError:p,RebindingError:l,CircularBindingError:c,TypeError:f}},{}],2:[function(e,t,r){"use strict";function n(e,t){var r=[];for(var n in t)r.push(n);try{var f=o.parse(e)}catch(d){throw d instanceof o.SyntaxError?new i.SyntaxError("At line "+d.line+" column "+d.column+": "+d.message):d}for(var h={params:[],body:f},m=0;m<r.length;m++){var n=r[m];h.params.push({type:"param",ident:n,inferredType:t[n]})}u(h),a(h),s(h),p(h);var y=l(h),v=[];v.push("(function(runtime, rootLexEnv) {\n"),v.push("  'use strict';\n"),v.push("  var topArgStreams = [];\n");for(var m=0;m<r.length;m++)v.push("  topArgStreams.push(rootLexEnv['"+r[m]+"']);\n");return v.push("  return "+c.indentFuncExpr(y)+"(runtime, 0, topArgStreams, null, '');\n"),v.push("})"),v.join("")}var o=e("./parser.js"),i=e("./errors.js"),u=e("./phaseExpand.js"),a=e("./phaseResolveNames.js"),s=e("./phaseTyping.js"),p=e("./phaseToposort.js"),l=e("./phaseCodegen.js"),c=e("./util.js");t.exports={compile:n,errors:i}},{"./errors.js":1,"./parser.js":3,"./phaseCodegen.js":4,"./phaseExpand.js":5,"./phaseResolveNames.js":6,"./phaseToposort.js":7,"./phaseTyping.js":8,"./util.js":10}],3:[function(e,t,r){t.exports=function(){function e(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function t(e,t,r,n,o,i){this.message=e,this.expected=t,this.found=r,this.offset=n,this.line=o,this.column=i,this.name="SyntaxError"}function r(e){function r(){return e.substring(gn,vn)}function n(e){throw u(e,null,gn)}function o(t){function r(t,r,n){var o,i;for(o=r;n>o;o++)i=e.charAt(o),"\n"===i?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return bn!==t&&(bn>t&&(bn=0,wn={line:1,column:1,seenCR:!1}),r(wn,bn,t),bn=t),wn}function i(e){Tn>vn||(vn>Tn&&(Tn=vn,En=[]),En.push(e))}function u(r,n,i){function u(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function a(e,t){function r(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var n,o,i,u=new Array(e.length);for(i=0;i<e.length;i++)u[i]=e[i].description;return n=e.length>1?u.slice(0,-1).join(", ")+" or "+u[e.length-1]:u[0],o=t?'"'+r(t)+'"':"end of input","Expected "+n+" but "+o+" found."}var s=o(i),p=i<e.length?e.charAt(i):null;return null!==n&&u(n),new t(null!==r?r:a(n,p),n,p,i,s.line,s.column)}function a(){var e;return e=ne()}function s(){var t;return Xe.test(e.charAt(vn))?(t=e.charAt(vn),vn++):(t=qe,0===xn&&i(ze)),t}function p(){var e,t;for(xn++,e=[],t=s();t!==qe;)e.push(t),t=s();return xn--,e===qe&&(t=qe,0===xn&&i(_e)),e}function l(){var t,r;if(t=[],Je.test(e.charAt(vn))?(r=e.charAt(vn),vn++):(r=qe,0===xn&&i(Ge)),r!==qe)for(;r!==qe;)t.push(r),Je.test(e.charAt(vn))?(r=e.charAt(vn),vn++):(r=qe,0===xn&&i(Ge));else t=He;return t}function c(){var t,r,n,o,u,a,s;return t=vn,r=p(),r!==qe?(45===e.charCodeAt(vn)?(n=We,vn++):(n=qe,0===xn&&i(Ze)),n===qe&&(n=Ke),n!==qe?(o=l(),o===qe&&(o=Ke),o!==qe?(46===e.charCodeAt(vn)?(u=$e,vn++):(u=qe,0===xn&&i(et)),u!==qe?(a=l(),a!==qe?(s=p(),s!==qe?(gn=t,r=tt(),t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t===qe&&(t=vn,r=p(),r!==qe?(45===e.charCodeAt(vn)?(n=We,vn++):(n=qe,0===xn&&i(Ze)),n===qe&&(n=Ke),n!==qe?(o=l(),o!==qe?(u=p(),u!==qe?(gn=t,r=tt(),t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)),t}function f(){var t;return rt.test(e.charAt(vn))?(t=e.charAt(vn),vn++):(t=qe,0===xn&&i(nt)),t}function d(){var t;return ot.test(e.charAt(vn))?(t=e.charAt(vn),vn++):(t=qe,0===xn&&i(it)),t}function h(){var e,t,r,n,o,i;if(e=vn,t=p(),t!==qe)if(r=vn,xn++,n=I(),xn--,n===qe?r=ut:(vn=r,r=He),r!==qe)if(n=f(),n!==qe){for(o=[],i=d();i!==qe;)o.push(i),i=d();o!==qe?(i=p(),i!==qe?(gn=e,t=at(n,o),e=t):(vn=e,e=He)):(vn=e,e=He)}else vn=e,e=He;else vn=e,e=He;else vn=e,e=He;return e}function m(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,4)===st?(n=st,vn+=4):(n=qe,0===xn&&i(pt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function y(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,5)===lt?(n=lt,vn+=5):(n=qe,0===xn&&i(ct)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function v(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===ft?(n=ft,vn+=2):(n=qe,0===xn&&i(dt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function g(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,4)===ht?(n=ht,vn+=4):(n=qe,0===xn&&i(mt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function b(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,4)===yt?(n=yt,vn+=4):(n=qe,0===xn&&i(vt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function w(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===gt?(n=gt,vn+=2):(n=qe,0===xn&&i(bt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function T(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,3)===wt?(n=wt,vn+=3):(n=qe,0===xn&&i(Tt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function E(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,3)===Et?(n=Et,vn+=3):(n=qe,0===xn&&i(xt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function x(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,3)===St?(n=St,vn+=3):(n=qe,0===xn&&i(Ct)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function S(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===At?(n=At,vn+=2):(n=qe,0===xn&&i(It)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function C(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,4)===Nt?(n=Nt,vn+=4):(n=qe,0===xn&&i(kt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function A(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,5)===Rt?(n=Rt,vn+=5):(n=qe,0===xn&&i(Dt)),n!==qe?(o=vn,xn++,u=d(),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function I(){var e;return e=m(),e===qe&&(e=y(),e===qe&&(e=v(),e===qe&&(e=g(),e===qe&&(e=b(),e===qe&&(e=w(),e===qe&&(e=T(),e===qe&&(e=E(),e===qe&&(e=x(),e===qe&&(e=S(),e===qe&&(e=C(),e===qe&&(e=A()))))))))))),e}function N(){var t,r,n,o;return t=vn,r=p(),r!==qe?(44===e.charCodeAt(vn)?(n=Lt,vn++):(n=qe,0===xn&&i(Ot)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function k(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(61===e.charCodeAt(vn)?(n=Vt,vn++):(n=qe,0===xn&&i(jt)),n!==qe?(o=vn,xn++,61===e.charCodeAt(vn)?(u=Vt,vn++):(u=qe,0===xn&&i(jt)),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function R(){var t,r,n,o;return t=vn,r=p(),r!==qe?(40===e.charCodeAt(vn)?(n=Ft,vn++):(n=qe,0===xn&&i(Pt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function D(){var t,r,n,o;return t=vn,r=p(),r!==qe?(41===e.charCodeAt(vn)?(n=Ut,vn++):(n=qe,0===xn&&i(Bt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function L(){var t,r,n,o;return t=vn,r=p(),r!==qe?(123===e.charCodeAt(vn)?(n=Mt,vn++):(n=qe,0===xn&&i(qt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function O(){var t,r,n,o;return t=vn,r=p(),r!==qe?(125===e.charCodeAt(vn)?(n=Yt,vn++):(n=qe,0===xn&&i(Qt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function V(){var t,r,n,o;return t=vn,r=p(),r!==qe?(46===e.charCodeAt(vn)?(n=$e,vn++):(n=qe,0===xn&&i(et)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function j(){var t,r,n,o;return t=vn,r=p(),r!==qe?(43===e.charCodeAt(vn)?(n=Xt,vn++):(n=qe,0===xn&&i(zt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function F(){var t,r,n,o;return t=vn,r=p(),r!==qe?(45===e.charCodeAt(vn)?(n=We,vn++):(n=qe,0===xn&&i(Ze)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function P(){var t,r,n,o;return t=vn,r=p(),r!==qe?(126===e.charCodeAt(vn)?(n=_t,vn++):(n=qe,0===xn&&i(Ht)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function U(){var t,r,n,o;return t=vn,r=p(),r!==qe?(42===e.charCodeAt(vn)?(n=Jt,vn++):(n=qe,0===xn&&i(Gt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function B(){var t,r,n,o;return t=vn,r=p(),r!==qe?(47===e.charCodeAt(vn)?(n=Kt,vn++):(n=qe,0===xn&&i(Wt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function M(){var t,r,n,o;return t=vn,r=p(),r!==qe?(43===e.charCodeAt(vn)?(n=Xt,vn++):(n=qe,0===xn&&i(zt)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function q(){var t,r,n,o;return t=vn,r=p(),r!==qe?(45===e.charCodeAt(vn)?(n=We,vn++):(n=qe,0===xn&&i(Ze)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function Y(){var t,r,n,o;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===Zt?(n=Zt,vn+=2):(n=qe,0===xn&&i($t)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function Q(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===er?(n=er,vn+=2):(n=qe,0===xn&&i(tr)),n!==qe?(o=vn,xn++,62===e.charCodeAt(vn)?(u=rr,vn++):(u=qe,0===xn&&i(nr)),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function X(){var t,r,n,o;return t=vn,r=p(),r!==qe?(e.substr(vn,3)===or?(n=or,vn+=3):(n=qe,0===xn&&i(ir)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function z(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(60===e.charCodeAt(vn)?(n=ur,vn++):(n=qe,0===xn&&i(ar)),n!==qe?(o=vn,xn++,60===e.charCodeAt(vn)?(u=ur,vn++):(u=qe,0===xn&&i(ar)),u===qe&&(61===e.charCodeAt(vn)?(u=Vt,vn++):(u=qe,0===xn&&i(jt))),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function _(){var t,r,n,o;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===sr?(n=sr,vn+=2):(n=qe,0===xn&&i(pr)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function H(){var t,r,n,o,u;return t=vn,r=p(),r!==qe?(62===e.charCodeAt(vn)?(n=rr,vn++):(n=qe,0===xn&&i(nr)),n!==qe?(o=vn,xn++,62===e.charCodeAt(vn)?(u=rr,vn++):(u=qe,0===xn&&i(nr)),u===qe&&(61===e.charCodeAt(vn)?(u=Vt,vn++):(u=qe,0===xn&&i(jt))),xn--,u===qe?o=ut:(vn=o,o=He),o!==qe?(u=p(),u!==qe?(r=[r,n,o,u],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function J(){var t,r,n,o;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===lr?(n=lr,vn+=2):(n=qe,0===xn&&i(cr)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function G(){var t,r,n,o;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===fr?(n=fr,vn+=2):(n=qe,0===xn&&i(dr)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function K(){var t,r,n,o;return t=vn,r=p(),r!==qe?(e.substr(vn,2)===hr?(n=hr,vn+=2):(n=qe,0===xn&&i(mr)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function W(){var t,r,n,o;return t=vn,r=p(),r!==qe?(38===e.charCodeAt(vn)?(n=yr,vn++):(n=qe,0===xn&&i(vr)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function Z(){var t,r,n,o;return t=vn,r=p(),r!==qe?(94===e.charCodeAt(vn)?(n=gr,vn++):(n=qe,0===xn&&i(br)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function $(){var t,r,n,o;return t=vn,r=p(),r!==qe?(124===e.charCodeAt(vn)?(n=wr,vn++):(n=qe,0===xn&&i(Tr)),n!==qe?(o=p(),o!==qe?(r=[r,n,o],t=r):(vn=t,t=He)):(vn=t,t=He)):(vn=t,t=He),t}function ee(){var e,t,r,n;return e=vn,t=h(),t!==qe?(r=N(),r!==qe?(n=ee(),n!==qe?(gn=e,t=Er(t,n),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He),e===qe&&(e=vn,t=h(),t!==qe&&(gn=e,t=xr(t)),e=t),e}function te(){var e,t,r,n;return e=vn,t=R(),t!==qe?(r=D(),r!==qe?(gn=e,t=Sr(),e=t):(vn=e,e=He)):(vn=e,e=He),e===qe&&(e=vn,t=R(),t!==qe?(r=ee(),r!==qe?(n=D(),n!==qe?(gn=e,t=Cr(r),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)),e}function re(){var e,t,r,n,o,i;return e=vn,t=m(),t!==qe?(r=te(),r!==qe?(n=L(),n!==qe?(o=ne(),o!==qe?(i=O(),i!==qe?(gn=e,t=Ar(r,o),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He),e}function ne(){var e,t,r;if(e=vn,t=[],r=oe(),r!==qe)for(;r!==qe;)t.push(r),r=oe();else t=He;return t!==qe&&(gn=e,t=Ir(t)),e=t}function oe(){var e,t,r,n;return e=vn,t=y(),t!==qe?(r=Le(),r!==qe?(gn=e,t=Nr(r),e=t):(vn=e,e=He)):(vn=e,e=He),e===qe&&(e=vn,t=h(),t!==qe?(r=k(),r!==qe?(n=Le(),n!==qe?(gn=e,t=kr(t,n),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)),e}function ie(){var e,t,r,n,o,i,u;return e=vn,t=R(),t!==qe?(r=Le(),r!==qe?(n=D(),n!==qe?(gn=e,t=Rr(r),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He),e===qe&&(e=vn,t=re(),t!==qe&&(gn=e,t=Dr(t)),e=t,e===qe&&(e=vn,t=C(),t!==qe&&(gn=e,t=Lr()),e=t,e===qe&&(e=vn,t=A(),t!==qe&&(gn=e,t=Or()),e=t,e===qe&&(e=vn,t=c(),t!==qe&&(gn=e,t=Vr(t)),e=t,e===qe&&(e=vn,t=v(),t!==qe?(r=Le(),r!==qe?(n=g(),n!==qe?(o=Le(),o!==qe?(i=b(),i!==qe?(u=Le(),u!==qe?(gn=e,t=jr(r,o,u),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He),e===qe&&(e=vn,t=h(),t!==qe&&(gn=e,t=Fr(t)),e=t)))))),e}function ue(){var e,t,r,n,o;if(e=vn,t=ie(),t!==qe){for(r=[],n=vn,o=Ve(),o!==qe&&(gn=n,o=Pr(o)),n=o,n===qe&&(n=vn,o=Oe(),o!==qe&&(gn=n,o=Ur(o)),n=o);n!==qe;)r.push(n),n=vn,o=Ve(),o!==qe&&(gn=n,o=Pr(o)),n=o,n===qe&&(n=vn,o=Oe(),o!==qe&&(gn=n,o=Ur(o)),n=o);r!==qe?(gn=e,t=Br(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function ae(){var e,t;return e=vn,t=j(),t!==qe&&(gn=e,t=Mr()),e=t,e===qe&&(e=vn,t=F(),t!==qe&&(gn=e,t=qr()),e=t,e===qe&&(e=vn,t=P(),t!==qe&&(gn=e,t=Yr()),e=t)),e}function se(){var e,t,r;for(e=vn,t=[],r=ae();r!==qe;)t.push(r),r=ae();return t!==qe?(r=ue(),r!==qe?(gn=e,t=Qr(t,r),e=t):(vn=e,e=He)):(vn=e,e=He),e}function pe(){var e,t;return e=vn,t=U(),t!==qe&&(gn=e,t=Xr()),e=t,e===qe&&(e=vn,t=B(),t!==qe&&(gn=e,t=zr()),e=t),e}function le(){var e,t,r,n,o,i;if(e=vn,t=se(),t!==qe){for(r=[],n=vn,o=pe(),o!==qe?(i=se(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=pe(),o!==qe?(i=se(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function ce(){var e,t;return e=vn,t=M(),t!==qe&&(gn=e,t=Hr()),e=t,e===qe&&(e=vn,t=q(),t!==qe&&(gn=e,t=Jr()),e=t),e}function fe(){var e,t,r,n,o,i;if(e=vn,t=le(),t!==qe){for(r=[],n=vn,o=ce(),o!==qe?(i=le(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=ce(),o!==qe?(i=le(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function de(){var e,t;return e=vn,t=Y(),t!==qe&&(gn=e,t=Gr()),e=t,e===qe&&(e=vn,t=Q(),t!==qe&&(gn=e,t=Kr()),e=t,e===qe&&(e=vn,t=X(),t!==qe&&(gn=e,t=Wr()),e=t)),e}function he(){var e,t,r,n,o,i;if(e=vn,t=fe(),t!==qe){for(r=[],n=vn,o=de(),o!==qe?(i=fe(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=de(),o!==qe?(i=fe(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function me(){var e,t;return e=vn,t=z(),t!==qe&&(gn=e,t=Zr()),e=t,e===qe&&(e=vn,t=_(),t!==qe&&(gn=e,t=$r()),e=t,e===qe&&(e=vn,t=H(),t!==qe&&(gn=e,t=en()),e=t,e===qe&&(e=vn,t=J(),t!==qe&&(gn=e,t=tn()),e=t,e===qe&&(e=vn,t=w(),t!==qe&&(gn=e,t=rn()),e=t)))),e}function ye(){var e,t,r,n,o,i;if(e=vn,t=he(),t!==qe){for(r=[],n=vn,o=me(),o!==qe?(i=he(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=me(),o!==qe?(i=he(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function ve(){var e,t;return e=vn,t=G(),t!==qe&&(gn=e,t=nn()),e=t,e===qe&&(e=vn,t=K(),t!==qe&&(gn=e,t=on()),e=t),e}function ge(){var e,t,r,n,o,i;if(e=vn,t=ye(),t!==qe){for(r=[],n=vn,o=ve(),o!==qe?(i=ye(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=ve(),o!==qe?(i=ye(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function be(){var e,t;return e=vn,t=W(),t!==qe&&(gn=e,t=un()),e=t}function we(){var e,t,r,n,o,i;if(e=vn,t=ge(),t!==qe){for(r=[],n=vn,o=be(),o!==qe?(i=ge(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=be(),o!==qe?(i=ge(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function Te(){var e,t;return e=vn,t=Z(),t!==qe&&(gn=e,t=an()),e=t}function Ee(){var e,t,r,n,o,i;if(e=vn,t=we(),t!==qe){for(r=[],n=vn,o=Te(),o!==qe?(i=we(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=Te(),o!==qe?(i=we(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function xe(){var e,t;return e=vn,t=$(),t!==qe&&(gn=e,t=sn()),e=t}function Se(){var e,t,r,n,o,i;if(e=vn,t=Ee(),t!==qe){for(r=[],n=vn,o=xe(),o!==qe?(i=Ee(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=xe(),o!==qe?(i=Ee(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function Ce(){var e,t;return e=vn,t=T(),t!==qe&&(gn=e,t=pn()),e=t}function Ae(){var e,t,r;for(e=vn,t=[],r=Ce();r!==qe;)t.push(r),r=Ce();return t!==qe?(r=Se(),r!==qe?(gn=e,t=Qr(t,r),e=t):(vn=e,e=He)):(vn=e,e=He),e}function Ie(){var e,t;return e=vn,t=E(),t!==qe&&(gn=e,t=ln()),e=t}function Ne(){var e,t,r,n,o,i;if(e=vn,t=Ae(),t!==qe){for(r=[],n=vn,o=Ie(),o!==qe?(i=Ae(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=Ie(),o!==qe?(i=Ae(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function ke(){var e,t;return e=vn,t=x(),t!==qe&&(gn=e,t=cn()),e=t}function Re(){var e,t,r,n,o,i;if(e=vn,t=Ne(),t!==qe){for(r=[],n=vn,o=ke(),o!==qe?(i=Ne(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=ke(),o!==qe?(i=Ne(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function De(){var e,t;return e=vn,t=S(),t!==qe&&(gn=e,t=fn()),e=t}function Le(){var e,t,r,n,o,i;if(e=vn,t=Re(),t!==qe){for(r=[],n=vn,o=De(),o!==qe?(i=Re(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);n!==qe;)r.push(n),n=vn,o=De(),o!==qe?(i=Re(),i!==qe?(o=[o,i],n=o):(vn=n,n=He)):(vn=n,n=He);r!==qe?(gn=e,t=_r(t,r),e=t):(vn=e,e=He)}else vn=e,e=He;return e}function Oe(){var e,t,r;return e=vn,t=V(),t!==qe?(r=h(),r!==qe?(gn=e,t=dn(r),e=t):(vn=e,e=He)):(vn=e,e=He),e}function Ve(){var e,t,r,n;return e=vn,t=R(),t!==qe?(r=D(),r!==qe?(gn=e,t=Sr(),e=t):(vn=e,e=He)):(vn=e,e=He),e===qe&&(e=vn,t=R(),t!==qe?(r=je(),r!==qe?(n=D(),n!==qe?(gn=e,t=hn(r),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He)),e}function je(){var e,t,r,n;return e=vn,t=Le(),t!==qe?(r=N(),r!==qe?(n=je(),n!==qe?(gn=e,t=mn(t,n),e=t):(vn=e,e=He)):(vn=e,e=He)):(vn=e,e=He),e===qe&&(e=vn,t=Le(),t!==qe&&(gn=e,t=yn(t)),e=t),e}function Fe(e,t){for(var r=e,n=0;n<t.length;n++)r={type:"op",op:t[n][0],args:[r].concat(t[n][1])};return r}function Pe(e,t){for(var r=t,n=e.length-1;n>=0;n--)r={type:"op",op:e[n],args:[r]};return r}function Ue(e){for(var t,r={},o=0;o<e.length;o++){var i=e[o];"yield"===i.type?(t&&n("Multiple yield clauses found in function body"),t=i.expr):"binding"===i.type?(r.hasOwnProperty(i.ident)&&n('Bindings have name "'+i.ident+'" bound more than once'),r[i.ident]=i.expr):n("Unexpected function body part")}return t||n("No yield clause found in function body"),{"yield":t,bindings:r}}var Be,Me=arguments.length>1?arguments[1]:{},qe={},Ye={start:a},Qe=a,Xe=/^[ \t\n\r]/,ze={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},_e={type:"other",description:"whitespace"},He=qe,Je=/^[0-9]/,Ge={type:"class",value:"[0-9]",description:"[0-9]"},Ke=null,We="-",Ze={type:"literal",value:"-",description:'"-"'},$e=".",et={type:"literal",value:".",description:'"."'},tt=function(){return parseFloat(r())},rt=/^[_a-z]/i,nt={type:"class",value:"[_a-z]i",description:"[_a-z]i"},ot=/^[_a-z0-9]/i,it={type:"class",value:"[_a-z0-9]i",description:"[_a-z0-9]i"},ut=void 0,at=function(e,t){return e+t.join("")},st="func",pt={type:"literal",value:"func",description:'"func"'},lt="yield",ct={type:"literal",value:"yield",description:'"yield"'},ft="if",dt={type:"literal",value:"if",description:'"if"'},ht="then",mt={type:"literal",value:"then",description:'"then"'},yt="else",vt={type:"literal",value:"else",description:'"else"'},gt="in",bt={type:"literal",value:"in",description:'"in"'},wt="not",Tt={type:"literal",value:"not",description:'"not"'},Et="and",xt={type:"literal",value:"and",description:'"and"'},St="xor",Ct={type:"literal",value:"xor",description:'"xor"'},At="or",It={type:"literal",value:"or",description:'"or"'},Nt="true",kt={type:"literal",value:"true",description:'"true"'},Rt="false",Dt={type:"literal",value:"false",description:'"false"'},Lt=",",Ot={type:"literal",value:",",description:'","'},Vt="=",jt={type:"literal",value:"=",description:'"="'},Ft="(",Pt={type:"literal",value:"(",description:'"("'},Ut=")",Bt={type:"literal",value:")",description:'")"'},Mt="{",qt={type:"literal",value:"{",description:'"{"'},Yt="}",Qt={type:"literal",value:"}",description:'"}"'},Xt="+",zt={type:"literal",value:"+",description:'"+"'},_t="~",Ht={type:"literal",value:"~",description:'"~"'},Jt="*",Gt={type:"literal",value:"*",description:'"*"'},Kt="/",Wt={type:"literal",value:"/",description:'"/"'},Zt="<<",$t={type:"literal",value:"<<",description:'"<<"'},er=">>",tr={type:"literal",value:">>",description:'">>"'},rr=">",nr={type:"literal",value:">",description:'">"'},or=">>>",ir={type:"literal",value:">>>",description:'">>>"'},ur="<",ar={type:"literal",value:"<",description:'"<"'},sr="<=",pr={type:"literal",value:"<=",description:'"<="'},lr=">=",cr={type:"literal",value:">=",description:'">="'},fr="==",dr={type:"literal",value:"==",description:'"=="'},hr="!=",mr={type:"literal",value:"!=",description:'"!="'},yr="&",vr={type:"literal",value:"&",description:'"&"'},gr="^",br={type:"literal",value:"^",description:'"^"'},wr="|",Tr={type:"literal",value:"|",description:'"|"'},Er=function(e,t){return[{type:"param",ident:e}].concat(t)},xr=function(e){return[{type:"param",ident:e}]},Sr=function(){return[]},Cr=function(e){return e},Ar=function(e,t){return{params:e,body:t}},Ir=function(e){return Ue(e)},Nr=function(e){return{type:"yield",expr:e}},kr=function(e,t){return{type:"binding",ident:e,expr:t}},Rr=function(e){return e},Dr=function(e){return{type:"literal",kind:"function",value:e}},Lr=function(){return{type:"literal",kind:"boolean",value:!0}},Or=function(){return{type:"literal",kind:"boolean",value:!1}},Vr=function(e){return{type:"literal",kind:"number",value:e}},jr=function(e,t,r){return{type:"op",op:"ifte",args:[e,t,r]}},Fr=function(e){return{type:"varIdent",ident:e}},Pr=function(e){return{internal:"app",argList:e}},Ur=function(e){return{internal:"dot",ident:e}},Br=function(e,t){for(var r=e,n=0;n<t.length;n++)if("app"===t[n].internal)r={type:"op",op:"app",args:[r].concat(t[n].argList)};else{if("dot"!==t[n].internal)throw new Error("internal error");r={type:"op",op:"prop",args:[r,{type:"literal",kind:"string",value:t[n].ident}]}}return r},Mr=function(){return"uplus"},qr=function(){return"uminus"},Yr=function(){return"bitnot"},Qr=function(e,t){return Pe(e,t)},Xr=function(){return"mul"},zr=function(){return"div"},_r=function(e,t){return Fe(e,t)},Hr=function(){return"add"},Jr=function(){return"sub"},Gr=function(){return"lshift"},Kr=function(){return"srshift"},Wr=function(){return"zrshift"},Zr=function(){return"lt"},$r=function(){return"lte"},en=function(){return"gt"},tn=function(){return"gte"},rn=function(){return"in"},nn=function(){return"eq"},on=function(){return"neq"},un=function(){return"bitand"},an=function(){return"bitxor"},sn=function(){return"bitor"},pn=function(){return"not"},ln=function(){return"and"},cn=function(){return"xor"},fn=function(){return"or"},dn=function(e){return e},hn=function(e){return e},mn=function(e,t){return[e].concat(t)},yn=function(e){return[e]},vn=0,gn=0,bn=0,wn={line:1,column:1,seenCR:!1},Tn=0,En=[],xn=0;if("startRule"in Me){if(!(Me.startRule in Ye))throw new Error("Can't start parsing from rule \""+Me.startRule+'".');Qe=Ye[Me.startRule]}if(Be=Qe(),Be!==qe&&vn===e.length)return Be;throw Be!==qe&&vn<e.length&&i({type:"end",description:"end of input"}),u(null,En,Tn)}return e(t,Error),{SyntaxError:t,parse:r}}()},{}],4:[function(e,t,r){"use strict";function n(e){function t(e){return(a+e.toString()).slice(-u)}function r(e){return"reg"+e.uid}for(var u=(e.sortedNodes.length-1).toString().length,a=Array(u).join("0"),s=0;s<e.sortedNodes.length;s++)e.sortedNodes[s].topoOrder=t(s);var p=[];p.push("(function(runtime, startTime, argStreams, baseTopoOrder, result) {\n"),p.push("  if (argStreams.length !== "+e.params.length+") { throw new Error('called with wrong number of arguments'); }\n");for(var l=[],s=0;s<e.sortedNodes.length;s++){var c=e.sortedNodes[s];if("op"===c.type){for(var f=[],d=0;d<c.args.length;d++)f.push(r(c.args[d]));var h="runtime.opFuncs."+c.op;p.push("  var act"+c.uid+" = "+h+"(runtime, startTime, ["+f.join(", ")+"], baseTopoOrder+'"+c.topoOrder+"', null); var "+r(c)+" = act"+c.uid+".outputStream;\n"),l.push("act"+c.uid+".deactivator()")}else if("param"===c.type)p.push("  var "+r(c)+" = argStreams["+c.position+"];\n");else if("literal"===c.type){var m;if("string"===c.kind)m="'"+c.value+"'";else if("boolean"===c.kind)m=c.value.toString();else if("number"===c.kind)m=c.value.toString();else{if("function"!==c.kind)throw new o.InternalError("Unexpected literal kind");m=i.indentFuncExpr(n(c.value))}p.push("  var "+r(c)+" = runtime.createConstStream("+m+", startTime);\n")}else if("delayed"===c.type){var y;if("step"===c.tempo)y="runtime.createStepStream(undefined, startTime)";else{if("event"!==c.tempo)throw new o.InternalError("Unexpected tempo");y="runtime.createEventStream(undefined, startTime)"}p.push("  var "+r(c)+" = "+y+";\n")}else{if("copy"!==c.type)throw new o.InternalError("Unexpected node type found in tree");var v,g="deactCopy"+c.uid;if("step"===c.tempo)v="runtime.addStepCopyTrigger";else{if("event"!==c.tempo)throw new o.InternalError("Unexpected tempo");v="runtime.addEventCopyTrigger"}p.push("  var "+g+" = "+v+"("+r(c.fromNode)+", "+r(c.toNode)+", startTime);\n"),l.push(g+"()")}}l.reverse();var b=r(e.body["yield"]);p.push("  var deactivateCopyTrigger;\n"),p.push("  if (result) {\n"),p.push("    deactivateCopyTrigger = runtime.addCopyTrigger("+b+", result.outputStream);\n"),p.push("  } else {\n"),p.push("    result = {outputStream: "+b+", deactivator: null};\n"),p.push("  }\n"),p.push("  if (result.deactivator) { throw new Error('deactivator should be null'); }\n"),p.push("  result.deactivator = function() {\n"),p.push("    if (deactivateCopyTrigger) { deactivateCopyTrigger(); }\n");for(var s=0;s<l.length;s++)p.push("    "+l[s]+";\n");return p.push("  };\n"),p.push("  return result;\n"),p.push("})"),p.join("")}var o=e("./errors.js"),i=e("./util.js");t.exports=n},{"./errors.js":1,"./util.js":10}],5:[function(e,t,r){"use strict";function n(e){function t(r){if(!r.containingFunction)if(r.containingFunction=e,"op"===r.type)for(var i=0;i<r.args.length;i++)t(r.args[i]);else if("varIdent"===r.type);else{if("literal"!==r.type)throw new o.InternalError("Unexpected node type");"function"===r.kind&&n(r.value)}}for(var r=0;r<e.params.length;r++)e.params[r].position=r,e.params[r].containingFunction=e;t(e.body["yield"]);for(var i in e.body.bindings)t(e.body.bindings[i])}var o=e("./errors.js");t.exports=n},{"./errors.js":1}],6:[function(e,t,r){"use strict";function n(e,t){function r(e){if("varIdent"!==e.type)throw new i.InternalError("Expected varIdent");if(e.resState===c)return e.resNode;if(e.resState===l)throw new i.CircularBindingError("Circular name bindings");if(void 0===e.resState){if(p.hasOwnProperty(e.ident)){var t=p[e.ident];return"varIdent"===t.type&&(e.resState=l,t=r(t)),e.resNode=t,e.resState=c,e.resNode}throw new i.NameResolutionError('Name "'+e.ident+'" not found')}throw new i.InternalError("Invalid resState")}function o(e){if("op"===e.type){if(e.resState===c)return e;e.resState=c;for(var t=0;t<e.args.length;t++)e.args[t]=o(e.args[t]);return e}if("varIdent"===e.type){var u=r(e);return o(u),u}if("param"===e.type)return e.resState===c?e:(e.resState=c,e);if("literal"===e.type)return e.resState===c?e:(e.resState=c,"function"===e.kind&&n(e.value,p),e);throw new i.InternalError("Unexpected node type")}for(var u={},a=0;a<e.params.length;a++)u[e.params[a].ident]=null;for(var s in e.body.bindings)if(u.hasOwnProperty(s))throw new i.RebindingError("Can't bind name "+s+" because it's the name of a parameter");var p={};for(var s in t)p[s]=t[s];for(var a=0;a<e.params.length;a++)p[e.params[a].ident]=e.params[a];for(var s in e.body.bindings)p[s]=e.body.bindings[s];var l=1,c=2;e.body["yield"]=o(e.body["yield"]);for(var s in e.body.bindings)e.body.bindings[s]=o(e.body.bindings[s])}function o(e){n(e,{})}var i=e("./errors.js");t.exports=o},{"./errors.js":1}],7:[function(e,t,r){"use strict";function n(e,t,r){function o(e,r){if(e.topoState===i)throw new u.CycleError("Cycle in computation graph found during topological sort");if(!(e.topoState===a&&r<=e.topoAddedToApplicationDepth)){if(e.topoState||(e.topoState=i,e.uid=t.getNext()),"op"===e.type)if("app"===e.op){var p=e.args[0].inferredType;if(p&&("function"!==p.tag||p.fields.params.length!==e.args.length-1))throw new u.InternalError("Should have been caught during type checking");o(e.args[0],r);for(var l=1;l<e.args.length;l++)if(p&&p.fields.params[l-1].delayed){var c={type:"delayed",uid:t.getNext(),
tempo:"step",containingFunction:e.containingFunction,topoState:a};e.containingFunction.sortedNodes.push(c);var f={type:"copy",uid:t.getNext(),tempo:"step",fromNode:e.args[l],toNode:c,containingFunction:e.containingFunction};s.push({node:f,applicationDepth:r}),e.args[l]=c}else o(e.args[l],r);o(e.args[0],r+1)}else for(var l=0;l<e.args.length;l++)o(e.args[l],r);else if("param"===e.type);else if("literal"===e.type);else{if("copy"!==e.type)throw new u.InternalError("Unexpected node type found during toposort");if(e.toNode.topoState!==a)throw new u.InternalError("Should have already been added");o(e.fromNode,r)}e.topoState===i&&(e.containingFunction.sortedNodes.push(e),e.topoState=a,"literal"===e.type&&"function"===e.kind&&e.containingFunction.subfunctions.push(e.value)),e.topoAddedToApplicationDepth=r,"literal"===e.type&&"function"===e.kind&&r>0&&n(e.value,t,r-1)}}var i=1,a=2;e.toposortVisited||(e.sortedNodes=[],e.subfunctions=[],e.toposortVisited=!0);var s=[];s.push({node:e.body["yield"],applicationDepth:r});for(var p in e.body.bindings)s.push({node:e.body.bindings[p],applicationDepth:r});for(;s.length>0;){var l=s.shift();o(l.node,l.applicationDepth)}for(var c=0;c<e.subfunctions.length;c++)e.subfunctions[c].toposortVisited||n(e.subfunctions[c],t,0)}function o(){this.next=1}function i(e){n(e,new o,0)}var u=e("./errors.js");o.prototype.getNext=function(){var e=this.next;return this.next++,e},t.exports=i},{"./errors.js":1}],8:[function(e,t,r){"use strict";function n(e){function t(e){if(!e.inferredType)if("op"===e.type){e.inferredType=a.createVariableType();for(var r=0;r<e.args.length;r++)t(e.args[r])}else{if("param"===e.type)throw new u.InternalError("Should not have gotten here");if("literal"!==e.type)throw new u.InternalError("Unexpected node type");if("function"===e.kind)n(e.value),e.inferredType=e.value.inferredType;else if("boolean"===e.kind)e.inferredType=a.BOOLEAN;else if("number"===e.kind)e.inferredType=a.NUMBER;else{if("string"!==e.kind)throw new u.InternalError("Unexpected literal kind");e.inferredType=a.STRING}}}if(!e.inferredType){for(var r=[],o=0;o<e.params.length;o++)if(!e.params[o].inferredType){var i=a.createVariableType();e.params[o].inferredType=i,r.push({type:i})}var s=a.createVariableType();e.inferredType=a.createFunctionType(r,s),t(e.body["yield"]);for(var p in e.body.bindings)t(e.body.bindings[p])}}function o(e){function t(e){if(!e.typeChecked)if(e.typeChecked=!0,"op"===e.type){for(var r=0;r<e.args.length;r++)t(e.args[r]);if("app"===e.op){for(var n=[],r=1;r<e.args.length;r++)n.push({type:e.args[r].inferredType});var i=e.inferredType,c=a.createFunctionType(n,i);a.unifyTypes(c,e.args[0].inferredType)}else if(s.hasOwnProperty(e.op)){a.unifyTypes(e.inferredType,a.NUMBER);for(var r=0;r<e.args.length;r++)a.unifyTypes(e.args[r].inferredType,a.NUMBER)}else if(p.hasOwnProperty(e.op)){a.unifyTypes(e.inferredType,a.BOOLEAN);for(var r=0;r<e.args.length;r++)a.unifyTypes(e.args[r].inferredType,a.BOOLEAN)}else l.hasOwnProperty(e.op)?(a.unifyTypes(e.inferredType,a.BOOLEAN),a.unifyTypes(e.args[0].inferredType,e.args[1].inferredType)):"ifte"===e.op?(a.unifyTypes(e.args[0].inferredType,a.BOOLEAN),a.unifyTypes(e.args[1].inferredType,e.args[2].inferredType),a.unifyTypes(e.inferredType,e.args[1].inferredType)):"prop"===e.op||"in"===e.op}else if("param"===e.type);else{if("literal"!==e.type)throw new u.InternalError("Unexpected node type");"function"===e.kind&&o(e.value)}}if(!e.typeChecked){e.typeChecked=!0,t(e.body["yield"]);for(var r in e.body.bindings)t(e.body.bindings[r])}}function i(e){n(e),o(e)}var u=e("./errors.js"),a=e("./typeUtils.js"),s={uplus:null,uminus:null,bitnot:null,mul:null,div:null,add:null,sub:null,lshift:null,srshift:null,zrshift:null,bitand:null,bitxor:null,bitor:null},p={not:null,and:null,xor:null,or:null},l={lt:null,lte:null,gt:null,gte:null,eq:null,neq:null};t.exports=i},{"./errors.js":1,"./typeUtils.js":9}],9:[function(e,t,r){"use strict";function n(){return{tag:"boolean",fields:null}}function o(){return{tag:"number",fields:null}}function i(){return{tag:"string",fields:null}}function u(e,t){return{tag:"function",fields:{params:e,"yield":t}}}function a(){var e={tag:"variable",fields:{uid:c,instances:[]}};return c+=1,e.fields.instances.push(e),e}function s(e,t){if("variable"!==e.tag)throw new l.InternalError("Can only assign to variable type");if("variable"!==t.tag||e.fields.uid!==t.fields.uid)for(var r=(e.fields.uid,e.fields.instances),n=0;n<r.length;n++){var o=r[n];o.tag=t.tag,o.fields=t.fields,"variable"===t.tag&&t.fields.instances.push(o)}}function p(e,t){if("variable"===e.tag&&"variable"===t.tag)t.fields.instances.length<=e.fields.instances.length?s(t,e):s(e,t);else if("variable"===e.tag)s(e,t);else if("variable"===t.tag)s(t,e);else if("boolean"===e.tag&&"boolean"===t.tag);else if("number"===e.tag&&"number"===t.tag);else if("string"===e.tag&&"string"===t.tag);else{if("function"!==e.tag||"function"!==t.tag)throw new l.TypeError("Types "+e+" and "+t+" can't be unified");if(e.fields.params.length!=t.fields.params.length)throw new l.TypeError("Types "+e+" and "+t+" can't be unified, mismatching number of params");for(var r=0;r<e.fields.params.length;r++)p(e.fields.params[r].type,t.fields.params[r].type);p(e.fields["yield"],t.fields["yield"])}}var l=e("./errors.js"),c=1;t.exports={createFunctionType:u,createVariableType:a,unifyTypes:p,BOOLEAN:n(),NUMBER:o(),STRING:i()}},{"./errors.js":1}],10:[function(e,t,r){"use strict";function n(e){for(var t=e.trim().split("\n"),r=1;r<t.length;r++)t[r]="  "+t[r];return t.join("\n")}t.exports={indentFuncExpr:n}},{}],11:[function(require,module,exports){"use strict";function initializeMasterTime(){initialDateNow=Date.now()}function getMasterTime(){return.001*(Date.now()-initialDateNow)}function tryRunning(){if(runtime.isRunnable()||rootLexEnv.redraw.hasTriggers()){var e=getMasterTime();rootLexEnv.redraw.emitValue(null,e);var t=runtime.runToTime(e);rootLexEnv.redraw.hasTriggers()&&!rafID&&(rafID=window.requestAnimationFrame(function(e){rafID=null,tryRunning()})),t&&!timeoutID&&(timeoutID=window.setTimeout(function(){timeoutID=null,updateInternalsDisplay(),tryRunning()},1e3*(t-e)),updateInternalsDisplay())}}function updateInternalsDisplay(){var e=[];e.push("Output changes: "+internals.outputChanges),e.push("JS timeout outstanding: "+!!timeoutID),document.getElementById("internals-notes").innerHTML=e.join("<br>")}function witnessOutput(e){var t=currentResult.outputStream.value;internals.outputChanges+=1,updateInternalsDisplay();var r=document.getElementById("square");r.style.left=t.x+1+"px",r.style.top=t.y+1+"px"}function compileAndStartProgram(code){if(currentResult){if(currentResult.deactivator(),currentResult.outputStream.removeTrigger(witnessOutput),timeoutID&&(window.clearTimeout(timeoutID),timeoutID=null,updateInternalsDisplay()),runtime.isRunnable())throw new Error("something went wrong");for(var k in rootLexEnv)if(rootLexEnv[k].hasTriggers())throw new Error("something went wrong")}initializeMasterTime(),runtime=new Runtime,rootLexEnv=runtime.createLexEnv({mouseX:runtime.createStepStream(inputValues.mouseX,0),mouseY:runtime.createStepStream(inputValues.mouseY,0),mousePos:runtime.createStepStream({x:inputValues.mouseX,y:inputValues.mouseY},0),mouseDown:runtime.createStepStream(inputValues.mouseDown,0),redraw:runtime.createEventStream(void 0,0)});var rootLexEnvTypes={mouseX:typeUtils.NUMBER,mouseY:typeUtils.NUMBER,mousePos:typeUtils.createVariableType(),mouseDown:typeUtils.BOOLEAN,redraw:typeUtils.createVariableType()};for(var k in runtime.builtins)rootLexEnv[k]=runtime.createConstStream(runtime.builtins[k].value,0),rootLexEnvTypes[k]=runtime.builtins[k].type;var mainFuncSrc=Compiler.compile(code,rootLexEnvTypes);console.log("compiled to JS:"),console.log(mainFuncSrc);var mainFunc=eval(mainFuncSrc);internals={outputChanges:0},updateInternalsDisplay(),currentResult=mainFunc(runtime,rootLexEnv),witnessOutput(0),currentResult.outputStream.addTrigger(witnessOutput),tryRunning()}function startDemoProg(e){document.getElementById("code-column-editor").value=e.source,document.getElementById("code-column-commentary").innerHTML=e.commentary||"",compileAndStartProgram(e.source)}function createDemoControls(){for(var e=document.getElementById("demos-list"),t=0;t<demoProgsList.length;t++){var r=demoProgsList[t],n=document.createElement("LI");n.setAttribute("class","demo-choice"),n.appendChild(document.createTextNode(r.title)),e.appendChild(n)}e.firstChild.classList.add("demo-active"),document.addEventListener("click",function(t){if(t.target.classList.contains("demo-choice")){for(var r=0;r<e.childNodes.length;r++)e.childNodes[r].classList.remove("demo-active");t.target.classList.add("demo-active");var n=t.target.textContent,o=demoProgsMap[n];startDemoProg(o)}},!1),document.getElementById("compile-button").addEventListener("click",function(e){compileAndStartProgram(document.getElementById("code-column-editor").value)})}for(var Runtime=require("../runtime"),Compiler=require("../compiler"),typeUtils=require("../compiler/typeUtils.js"),demoProgsMap={},demoProgsList=[],demoProgsData='same position\n---\nyield mousePos\n---\n<p>This program simply yields the mouse position unchanged, causing the square to be at the same position as the mouse.</p>\n\n=====\n\ndelayed position\n---\nyield delay1(mousePos)\n---\n<p>This program yields the mouse position delayed by 1 second. Note the behavior of the "JS timeout outstanding" value on the left, as you alternately move the mouse and stop moving it for a bit. If there are "buffered" mouse movements still to be played out, there is a timeout set for those. If the mouse has been still for a least one second, no changes will be buffered and so no timeout will be set.</p><p>Also note, if you quickly move the pointer and click to start this same program again, the square jumps to match the mouse position. This is because the delay1 function relays its initial input as its output for the first second.</p>\n\n=====\n\nswitch on button\n---\nyield if mouseDown then mousePos else delay1(mousePos)\n---\n<p>This program switches between yielding the current mouse position and the delayed mouse position, based on whether the mouse button is down. The if/then/else syntax is an expression (like the ternary operator "?:"), not a statement.</p><p>Note that even if the mouse button is held down, the delayed position is computed. This is necessary to avoid "time leaks", i.e. we don\\\'t know when we\\\'ll need the value when the mouse button is released, so we must keep it up to date.</p>\n\n=====\n\ndynamic application\n---\nyield (if mouseDown then id else delay1)(mousePos)\n---\n<p>This program illustrates a subtle and important detail, when compared to the previous program. In this program, we apply a function to the mouse position, but the value of that function we apply is itself dynamic. It switches from the value "id" (identity function) to the value "delay1". This is similar to the previous program, except when the mouse is released, the square stays at the current mouse position. This is because when id or delay1 are switched into action, they always start "from scratch". Only one is running at a time. And when delay1 starts, it mirrors its input for the first second. In the previous program, delay1 is always running.</p>\n\n=====\n\nprops and ctor\n---\nyield Vec2(mousePos.y, mousePos.x)\n---\n<p>This program demonstrates property access with the dot operator, and calling a "constructor" function which is just a builtin in this case.</p>\n\n=====\n\nbasic math, bindings\n---\nx = 800 - 1.5*mousePos.x\ny = mousePos.y + 50\nyield Vec2(x, y)\n---\n<p>Here we demonstrate binding expressions to names and basic math operators. Note the precedence of multiplicative operators over additive operators.</p>\n\n=====\n\nstrange movement\n---\nx = 0.5*delay1(mousePos.x) + 0.5*mousePos.x\ny = 0.5*delay1(mousePos.y) + 0.5*mousePos.y\nyield Vec2(x, y)\n---\n<p>The output position is halfway between the current mouse position and the 1-second-delayed mouse position. This type of thing would be annoying to code in regular Javascript, but is easy in this language.</p>\n\n=====\n\ntime dependence\n---\nt = timeOfLatest(redraw)\nyield Vec2(mousePos.x + 50*cos(10*t), mousePos.y + 50*sin(10*t))\n---\n<p></p>\n\n=====\n\nfunction definition\n---\ndelay1X = func(v) {\n  yield Vec2(delay1(v.x), v.y)\n}\nyield delay1X(mousePos)\n---\n<p>Anonymous functions can be declared with the func keyword, and bound to names like any other value. Lexical scoping allows them to access names bound in outer scopes.</p>\n\n=====\n\nintegral\n---\naccY = if mouseDown then 1200 else -300\nvelY = integral(accY, 300, redraw)\ny = integral(velY, 0, redraw)\nyield Vec2(mousePos.x, 200-y)\n---\n<p>Acceleration in Y axis is determined by whether or not mouse button is down. Velocity is integral of acceleration, position is integral of velocity.</p>\n',demoProgsDataList=demoProgsData.split("\n=====\n"),i=0;i<demoProgsDataList.length;i++){var progFields=demoProgsDataList[i].split("\n---\n");if(3!==progFields.length)throw new Error("Problem loading demo programs");var title=progFields[0].trim(),source=progFields[1].trim(),commentary=progFields[2].trim(),progInfo={title:title,source:source,commentary:commentary};demoProgsMap[title]=progInfo,demoProgsList.push(progInfo)}var initialDateNow,runtime,rootLexEnv,timeoutID,rafID,currentResult,inputValues={mouseX:0,mouseY:0,mouseDown:!1},internals;document.addEventListener("mousemove",function(e){var t=getMasterTime();inputValues.mouseX=e.clientX||e.pageX,inputValues.mouseY=e.clientY||e.pageY,rootLexEnv.mouseX.changeValue(inputValues.mouseX,t),rootLexEnv.mouseY.changeValue(inputValues.mouseY,t),rootLexEnv.mousePos.changeValue({x:inputValues.mouseX,y:inputValues.mouseY},t),tryRunning()},!1),document.addEventListener("mousedown",function(e){if(0===e.button){var t=getMasterTime();inputValues.mouseDown=!0,rootLexEnv.mouseDown.changeValue(inputValues.mouseDown,t),tryRunning()}},!1),document.addEventListener("mouseup",function(e){if(0===e.button){var t=getMasterTime();inputValues.mouseDown=!1,rootLexEnv.mouseDown.changeValue(inputValues.mouseDown,t),tryRunning()}},!1),document.addEventListener("DOMContentLoaded",function(){createDemoControls(),startDemoProg(demoProgsList[0])})},{"../compiler":2,"../compiler/typeUtils.js":9,"../runtime":13}],12:[function(e,t,r){"use strict";function n(e,t,r,n,o){if(1!==r.length)throw new Error("got wrong number of arguments");var i=r[0],u=i.value;if(o){if("step"!==o.outputStream.tempo)throw new Error("Incorrect output stream tempo");o.outputStream.changeValue(u,t)}else o={outputStream:e.createStepStream(u,t),deactivator:null};if(o.deactivator)throw new Error("Deactivator should be null");o.deactivator=function(){i.removeTrigger(f),s&&e.priorityQueue.remove(s)};var a=[],s=null,p=function(){if(a.length>0&&!s){var t=a[0],r={time:t.time,topoOrder:n,closure:l};e.priorityQueue.insert(r),s=r}},l=function(e){if(0===a.length)throw new Error("no changes to make");var t=a.shift();if(e!==t.time)throw new Error("times do not match");o.outputStream.changeValue(t.value,e),s=null,p()},c=function(e){var t=i.value;a.push({time:e+1,value:t}),p()},f=function(t){e.priorityQueue.insert({time:t,topoOrder:n,closure:c})};return i.addTrigger(f),o.deactivator=function(){i.removeTrigger(f),s&&e.priorityQueue.remove(s)},o}function o(e,t,r,n,o){if(1!==r.length)throw new Error("got wrong number of arguments");var i=r[0];if("event"!==i.tempo)throw new Error("Incorrect input stream tempo");if(o){if("step"!==o.outputStream.tempo)throw new Error("Incorrect output stream tempo");o.outputStream.changeValue(0,t)}else o={outputStream:e.createStepStream(0,t),deactivator:null};if(o.deactivator)throw new Error("Deactivator should be null");o.deactivator=function(){i.removeTrigger(a)};var u=function(e){o.outputStream.changeValue(e-t,e)},a=function(t){e.priorityQueue.insert({time:t,topoOrder:n,closure:u})};return i.addTrigger(a),o}function i(e,t,r,n,o){function i(e){void 0!==c&&(p+=(e-l)*c),l=e,c=u.value}if(3!==r.length)throw new Error("got wrong number of arguments");var u=r[0];if("step"!==u.tempo)throw new Error("Argument integrand must be step");var a=r[1];if("const"!==a.tempo)throw new Error("Argument initialValue must be const");var s=r[2];if("event"!==s.tempo)throw new Error("Argument update must be event");if(o){if("step"!==o.outputStream.tempo)throw new Error("Incorrect output stream tempo");o.outputStream.changeValue(0,t)}else o={outputStream:e.createStepStream(0,t),deactivator:null};var p=a.value,l=t,c=void 0,f=function(e){i(e)},d=function(t){e.priorityQueue.insert({time:t,topoOrder:n+"0",closure:f})};u.addTrigger(d);var h=function(e){i(e),o.outputStream.changeValue(p,e)},m=function(t){e.priorityQueue.insert({time:t,topoOrder:n+"1",closure:h})};if(s.addTrigger(m),o.deactivator)throw new Error("Deactivator should be null");return o.deactivator=function(){s.removeTrigger(m),u.removeTrigger(d)},o}var u=e("../compiler/typeUtils.js"),a=e("./primUtils"),s=a.liftStep;t.exports={id:{value:s(function(e){return e},1),type:function(){var e=u.createVariableType();return u.createFunctionType([{type:e}],e)}()},Vec2:{value:s(function(e,t){return{x:e,y:t}},2),type:u.createFunctionType([{type:u.NUMBER},{type:u.NUMBER}],u.createVariableType())},sin:{value:s(function(e){return Math.sin(e)},1),type:u.createFunctionType([{type:u.NUMBER}],u.NUMBER)},cos:{value:s(function(e){return Math.cos(e)},1),type:u.createFunctionType([{type:u.NUMBER}],u.NUMBER)},delay1:{value:n,type:function(){var e=u.createVariableType();return u.createFunctionType([{type:e}],e)}()},timeOfLatest:{value:o,type:u.createFunctionType([{type:u.createVariableType()}],u.NUMBER)},integral:{value:i,type:u.createFunctionType([{type:u.NUMBER,delayed:!0},{type:u.NUMBER},{type:u.createVariableType()}],u.NUMBER)}}},{"../compiler/typeUtils.js":9,"./primUtils":18}],13:[function(e,t,r){"use strict";var n=e("./pq"),o=e("./streams"),i=o.ConstStream,u=o.StepStream,a=o.EventStream,s=function(){this.priorityQueue=new n};s.prototype.createLexEnv=function(e){return this.deriveLexEnv(null,e)},s.prototype.deriveLexEnv=function(e,t){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]={value:t[n],writeable:!1,enumerable:!0});return Object.create(e,r)},s.prototype.createConstStream=function(e,t){return new i(e,t)},s.prototype.createStepStream=function(e,t){return new u(e,t)},s.prototype.createEventStream=function(e,t){return new a(e,t)},s.prototype.addStepCopyTrigger=function(e,t,r){function n(r){t.changeValue(e.value,r)}return n(r),e.addTrigger(n),function(){e.removeTrigger(n)}},s.prototype.addEventCopyTrigger=function(e,t,r){function n(r){t.emitValue(e.value,r)}return e.value&&n(r),e.addTrigger(n),function(){e.removeTrigger(n)}},s.prototype.runToTime=function(e){for(;;){if(this.priorityQueue.isEmpty())return null;var t=this.priorityQueue.peek();if(t.time>e)return t.time;this.runNextTask()}},s.prototype.runNextTask=function(){var e=this.priorityQueue.pull();e.closure(e.time)},s.prototype.isRunnable=function(){return!this.priorityQueue.isEmpty()},s.prototype.builtins=e("./builtins"),s.prototype.opFuncs=e("./opFuncs"),t.exports=s},{"./builtins":12,"./opFuncs":16,"./pq":17,"./streams":19}],14:[function(e,t,r){t.exports=e("./lib/heap")},{"./lib/heap":15}],15:[function(e,t,r){(function(){var e,n,o,i,u,a,s,p,l,c,f,d,h,m,y;o=Math.floor,c=Math.min,n=function(e,t){return t>e?-1:e>t?1:0},l=function(e,t,r,i,u){var a;if(null==r&&(r=0),null==u&&(u=n),0>r)throw new Error("lo must be non-negative");for(null==i&&(i=e.length);i>r;)a=o((r+i)/2),u(t,e[a])<0?i=a:r=a+1;return[].splice.apply(e,[r,r-r].concat(t)),t},a=function(e,t,r){return null==r&&(r=n),e.push(t),m(e,0,e.length-1,r)},u=function(e,t){var r,o;return null==t&&(t=n),r=e.pop(),e.length?(o=e[0],e[0]=r,y(e,0,t)):o=r,o},p=function(e,t,r){var o;return null==r&&(r=n),o=e[0],e[0]=t,y(e,0,r),o},s=function(e,t,r){var o;return null==r&&(r=n),e.length&&r(e[0],t)<0&&(o=[e[0],t],t=o[0],e[0]=o[1],y(e,0,r)),t},i=function(e,t){var r,i,u,a,s,p;for(null==t&&(t=n),a=function(){p=[];for(var t=0,r=o(e.length/2);r>=0?r>t:t>r;r>=0?t++:t--)p.push(t);return p}.apply(this).reverse(),s=[],i=0,u=a.length;u>i;i++)r=a[i],s.push(y(e,r,t));return s},h=function(e,t,r){var o;return null==r&&(r=n),o=e.indexOf(t),-1!==o?(m(e,0,o,r),y(e,o,r)):void 0},f=function(e,t,r){var o,u,a,p,l;if(null==r&&(r=n),u=e.slice(0,t),!u.length)return u;for(i(u,r),l=e.slice(t),a=0,p=l.length;p>a;a++)o=l[a],s(u,o,r);return u.sort(r).reverse()},d=function(e,t,r){var o,a,s,p,f,d,h,m,y,v;if(null==r&&(r=n),10*t<=e.length){if(p=e.slice(0,t).sort(r),!p.length)return p;for(s=p[p.length-1],m=e.slice(t),f=0,h=m.length;h>f;f++)o=m[f],r(o,s)<0&&(l(p,o,0,null,r),p.pop(),s=p[p.length-1]);return p}for(i(e,r),v=[],a=d=0,y=c(t,e.length);y>=0?y>d:d>y;a=y>=0?++d:--d)v.push(u(e,r));return v},m=function(e,t,r,o){var i,u,a;for(null==o&&(o=n),i=e[r];r>t&&(a=r-1>>1,u=e[a],o(i,u)<0);)e[r]=u,r=a;return e[r]=i},y=function(e,t,r){var o,i,u,a,s;for(null==r&&(r=n),i=e.length,s=t,u=e[t],o=2*t+1;i>o;)a=o+1,i>a&&!(r(e[o],e[a])<0)&&(o=a),e[t]=e[o],t=o,o=2*t+1;return e[t]=u,m(e,s,t,r)},e=function(){function e(e){this.cmp=null!=e?e:n,this.nodes=[]}return e.push=a,e.pop=u,e.replace=p,e.pushpop=s,e.heapify=i,e.updateItem=h,e.nlargest=f,e.nsmallest=d,e.prototype.push=function(e){return a(this.nodes,e,this.cmp)},e.prototype.pop=function(){return u(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return p(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return s(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return i(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return h(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return t=new e,t.nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),function(e,n){return"function"==typeof define&&define.amd?define([],n):"object"==typeof r?t.exports=n():e.Heap=n()}(this,function(){return e})}).call(this)},{}],16:[function(e,t,r){"use strict";function n(e,t,r,n,o){function i(t){void 0!==u&&(u.deactivator(),u.deactivator=null);var r=a.value;u?r(e,t,s,n,u):u=r(e,t,s,n,null)}var u,a=r[0],s=r.slice(1);return i(t),a.addTrigger(i),{outputStream:u.outputStream,deactivator:function(){a.removeTrigger(i),u.deactivator()}}}var o=e("./primUtils"),i=o.liftStep;t.exports={ifte:i(function(e,t,r){return e?t:r},3),app:n,prop:i(function(e,t){return e[t]},2),uplus:i(function(e){return+e},1),uminus:i(function(e){return-e},1),bitnot:i(function(e){return~e},1),mul:i(function(e,t){return e*t},2),div:i(function(e,t){return e/t},2),add:i(function(e,t){return e+t},2),sub:i(function(e,t){return e-t},2),lshift:i(function(e,t){return e<<t},2),srshift:i(function(e,t){return e>>t},2),zrshift:i(function(e,t){return e>>>t},2),lt:i(function(e,t){return t>e},2),lte:i(function(e,t){return t>=e},2),gt:i(function(e,t){return e>t},2),gte:i(function(e,t){return e>=t},2),"in":i(function(e,t){return e in t},2),eq:i(function(e,t){return e===t},2),neq:i(function(e,t){return e!==t},2),bitand:i(function(e,t){return e&t},2),bitxor:i(function(e,t){return e^t},2),bitor:i(function(e,t){return e|t},2),not:i(function(e,t){return!e},1),and:i(function(e,t){return e&&t},2),xor:i(function(e,t){return!!e^!!t},2),or:i(function(e,t){return e||t},2)}},{"./primUtils":18}],17:[function(e,t,r){"use strict";var n=e("heap"),o=function(){this.heap=new n(function(e,t){return e.time===t.time?e.topoOrder<t.topoOrder?-1:t.topoOrder>e.topoOrder?1:0:e.time-t.time})};o.prototype.isEmpty=function(){return this.pullRemoved(),this.heap.empty()},o.prototype.insert=function(e){this.heap.push(e)},o.prototype.peek=function(){return this.pullRemoved(),this.heap.peek()},o.prototype.pull=function(){this.pullRemoved();for(var e=this.heap.pop();;){if(this.pullRemoved(),this.heap.empty())break;var t=this.heap.peek();if(t.time!==e.time||t.topoOrder!==e.topoOrder||t.closure!==e.closure)break;this.heap.pop()}return e},o.prototype.remove=function(e){e.removed=!0},o.prototype.pullRemoved=function(){for(;!this.heap.empty();){var e=this.heap.peek();if(!e.removed)break;this.heap.pop()}},t.exports=o},{heap:14}],18:[function(e,t,r){"use strict";function n(e,t){return function(r,n,o,i,u){function a(){for(var r=[],n=0;t>n;n++)r.push(o[n].value);return e.apply(null,r)}function s(e){u.outputStream.changeValue(a(),e)}function p(e){r.priorityQueue.insert({time:e,topoOrder:i,closure:s})}if(o.length!==t)throw new Error("got wrong number of arguments");if(u){if("step"!==u.outputStream.tempo)throw new Error("Incorrect output stream tempo");u.outputStream.changeValue(a(),n)}else u={outputStream:r.createStepStream(a(),n),deactivator:null};if(u.deactivator)throw new Error("Deactivator should be null");u.deactivator=function(){for(var e=0;t>e;e++)o[e].removeTrigger(p)};for(var l=0;t>l;l++)o[l].addTrigger(p);return u}}t.exports={liftStep:n}},{}],19:[function(e,t,r){"use strict";var n=function(){},o=function(e,t){this.value=e,this.startTime=t,this.triggers=[]};o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.tempo="const",o.prototype.addTrigger=function(e){},o.prototype.removeTrigger=function(e){},o.prototype.hasTriggers=function(){return!1};var i=function(){this.funcs=[]};i.prototype.add=function(e){this.funcs.push(e)},i.prototype.remove=function(e){for(var t,r=0;r<this.funcs.length;r++)if(this.funcs[r]===e){t=r;break}if(void 0===t)throw new Error("no matching func found");this.funcs.splice(t,1)},i.prototype.fire=function(e){for(var t=0;t<this.funcs.length;t++)this.funcs[t](e)},i.prototype.isEmpty=function(){return 0===this.funcs.length};var u=function(e,t){this.value=e,this.startTime=t,this.triggerSet=new i};u.prototype=Object.create(n.prototype),u.prototype.constructor=u,u.prototype.tempo="step",u.prototype.changeValue=function(e,t){this.value=e,this.triggerSet.fire(t)},u.prototype.addTrigger=function(e){this.triggerSet.add(e)},u.prototype.removeTrigger=function(e){this.triggerSet.remove(e)},u.prototype.hasTriggers=function(){return!this.triggerSet.isEmpty()};var a=function(e,t){this.value=e,this.startTime=t,this.triggerSet=new i};a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.tempo="event",a.prototype.emitValue=function(e,t){this.value=e,this.triggerSet.fire(t)},a.prototype.addTrigger=function(e){this.triggerSet.add(e)},a.prototype.removeTrigger=function(e){this.triggerSet.remove(e)},a.prototype.hasTriggers=function(){return!this.triggerSet.isEmpty()},t.exports={ConstStream:o,StepStream:u,EventStream:a}},{}]},{},[11]);
